{% extends 'base.html' %}

{% block content %}
{% load guardian_tags %}

    <h2>Tags</h2>

    {% if tags %}
        <ul>
            {% if not edit_tag_id %}
                <form action="{% url 'notes:index' %}" method="post" novalidate>
                {% csrf_token %}
            {% endif %}
            {% for tag in tags %}
            {% get_obj_perms request.user for tag as "tag_perms" %}
                <li>
                    {% if not edit_tag_id %}
                        <input type="checkbox" name="tags" value="{{ tag.name }}">
                    {% endif %}

                    {% if edit_tag_id != tag.id %}
                        {% with tags=tag.name %}
                            <a href="{% url 'notes:tagged' %}?tags={{ tags }}">{{ tag.name|safe }}</a>
                        {% endwith %}

                        {% if 'view_guardedtag' in tag_perms %}
                            <a href="{% url 'tags:edit' tag.id %}">Edit</a>
                        {% else %}
                            <span style="color: grey;">Edit</span>
                        {% endif %}

                        {% if 'view_guardedtag' in tag_perms %}
                            <span id="del_tag({{ tag.id }})" style="display: inline;">
                                <a href="#" onclick="show_hide('confirm_del_tag({{ tag.id }})', 'del_tag({{ tag.id }})'); return false;">Delete</a>
                            </span>
                            <strong><span id="confirm_del_tag({{ tag.id }})" style="display: none;">
                                Confirm deleting tag:
                                <a style="color: red;" href="{% url 'tags:delete' tag.id %}">Yes</a>
                                /
                                <a href="#" onclick="show_hide('del_tag({{ tag.id }})', 'confirm_del_tag({{ tag.id }})'); return false;">No</a>
                            </span></strong>
                        {% else %}
                            <span style="color: grey;">Delete</span>
                        {% endif %}
                    {% else %}
                        <form action="{% url 'tags:edit' tag.id %}" method="post">
                            {% csrf_token %}

                            {{ form.non_field_errors }}

                            {{ form.name.errors }}
                            {{ form.name }}
                            <input type="submit" value="Submit">
                        </form>
                    {% endif %}
                </li>
            {% endfor %}
            {% if not edit_tag_id %}
                <br><input type="Submit" value="Look for notes with any of selected tags">
                </form>
            {% endif %}
        </ul>
    {% else %}
        <p>No tags to display.</p>
    {% endif %}

	<script type="text/javascript" >
		function show_hide(show_id, hide_id){
			document.getElementById(show_id).style.display = 'inline';
			document.getElementById(hide_id).style.display = 'none';
        }
	</script>
{% endblock %}
